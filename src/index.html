<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Downline</title>
  <link rel="stylesheet" href="../static/css/fontawesome.min.css">
  <link rel="stylesheet" href="../static/css/solid.min.css">
  <link rel="stylesheet" href="../static/css/app.css">
  <link rel="stylesheet" href="../static/css/titlebar.css">
  <link rel="stylesheet" href="../static/css/main-page.css">
  <link rel="stylesheet" href="../static/css/downloadable.css">
  <link rel="stylesheet" href="../static/css/extras.css">
</head>

<body>
  <div id="app">
    <section id="titlebar">
      <span v-if="!isExtrasOpen" class="fas fa-cog" @click="isExtrasOpen=true"></span>
      <span v-else class="fas fa-arrow-left" @click="isExtrasOpen=false"></span>
      <h1>Downline</h1>
      <span id="minimize-btn" @click="minimize">&minus;</span>
      <span id="close-btn" @click="close">&times;</span>
    </section>

    <section id="main-page" v-show="!isExtrasOpen">
      <section id="top">
        <div id="inputbar">
          <input v-model="newURL" @keyup.enter="fetchInfo" type="text" spellcheck="false" placeholder="Enter URL">
          <span @click="fetchInfo">&plus;</span>
        </div>

        <div id="global-options" v-if="existsItems">
          <div v-if="anyToBeDownloaded">
            <span class="fas fa-chevron-circle-left" @click="decrement(global)"></span>
            <span id="global-quality">{{ chosenQuality(global) }}</span>
            <span class="fas fa-chevron-circle-right" @click="increment(global)"></span>
          </div>

          <span v-if="anyToBeDownloaded" class="fas" @click="updateChosenProp('subs')" :class="{selected: global.isSubsChosen, 'fa-closed-captioning': anySubbed}"></span>
          <span v-if="anyToBeDownloaded" class="fas fa-music" @click="updateChosenProp('audio')" :class="{selected: global.isAudioChosen}"></span>
          <span v-else></span>
          <button @click="downloadOrPauseMany"> {{ areChosenDownloading?'Pause':'Download' }} {{ anyChosen?'Selected':'All' }}</button>
        </div>
      </section>

      <section id="center">
        <div class="downloadable" :class="{chosen: item.isChosen}" v-for="(item, index) in downloadables">
          <section class="left" @dblclick="choose(item)" @click="toggle(item)">
            <img :src="item.thumbnail">
            <span>{{ item.duration }}</span>
          </section>

          <section class="middle">
            <h1>{{ item.title }}</h1>
            <div class="options" v-if="item.progress.value == 0 && item.state === 'stopped'">
              <div>
                <span class="fas fa-chevron-circle-left" @click="decrement(item)"></span>
                <span class="quality">{{ chosenQuality(item) }}</span>
                <span class="fas fa-chevron-circle-right" @click="increment(item)"></span>
              </div>

              <span class="option-icon fas" :class="{'fa-closed-captioning': item.subtitles.length !== 0, selected: item.isSubsChosen}"  @click="item.isSubsChosen = !item.isSubsChosen"></span>
              <span class="option-icon fas fa-music" :class="{selected: item.isAudioChosen}" @click="item.isAudioChosen = !item.isAudioChosen"></span>
            </div>

            <div class="progress" v-else>
              <span class="info">
                <span v-if="isStarting(item)">Starting Download</span>
                <span v-else-if="isQueued(item)">Queued</span>
                <span v-else-if="isPaused(item) || isDownloading(item)">
                  {{ item.progress.value }}% of {{ item.progress.size }}
                  <span v-if="isDownloading(item)"> 
                    &centerdot; {{ item.progress.speed }} | {{ item.progress.eta }}
                  </span>
                </span>
                <span v-else>Download Complete</span>
              </span>

              <span class="bar">
                <span class="value" :style="progressValue(item.url)"></span>
              </span>
            </div>
          </section>

          <section class="right">
            <span class="close" @click="clear(item.url)">&times;</span>

            <span class="fas fa-play" v-if="item.state === 'stopped'" @click="download(item.url)"></span>
            <span class="fas fa-pause" v-if="item.state === 'downloading' || item.state === 'queued'" @click="pause(item.url)"></span>
            <span class="fas fa-check" v-if="item.state === 'completed'"></span>
          </section>
        </div>
      </section>

      <section id="bottom">
        <span id="message">
          <span v-if="loadingItems !== 0" class="spinner"></span> 
          <span v-if="loadingItems !== 0">Loading {{ loadingItems }} {{ loadingItems>1?'URLs':'URL' }}</span>
        </span>
        <button v-if="anyCompleted" id="clear-completed-btn" @click="clearCompleted">Clear Completed</button>
        <button v-if="existsItems" id="clear-many-btn" @click="clearMany">Clear {{ anyChosen?'Selected':'All' }}</button>
      </section>
    </section>

    <section id="extras" v-show="isExtrasOpen">
      <ul id="tabs">
        <li @click="activeTab = 'settings'" :class="{active: activeTab === 'settings'}">Settings</li>
        <li @click="activeTab = 'about'" :class="{active: activeTab === 'about'}">About</li>
      </ul>
      
      <div id="settings" v-if="activeTab === 'settings'">
        <div id="download-location">
          <label>Download Location</label>
          <div>
            <span id="location-text">{{ downloadLocation }}</span>
            <button id="choose-location" @click="selectDirectory">Browse</button>
          </div>
        </div>

        <div id="max-simultaneous">
          <label>Simultaneous Downloads (max. 5)</label>
          <div>
            <span class="fas fa-chevron-circle-left" @click="maxSimultaneous = maxSimultaneous>1?--maxSimultaneous:maxSimultaneous"></span>
            <span id="max-simultaneous-text">{{ maxSimultaneous }}</span>
            <span class="fas fa-chevron-circle-right" @click="maxSimultaneous = maxSimultaneous<5?++maxSimultaneous:maxSimultaneous"></span>
          </div>
        </div>
      </div>
      <div id="about" v-else-if="activeTab === 'about'">
        <img src="../static/images/icon.png">
        <p id="app-name">
          Downline 
          <em>{{ appVersion }}</em>
        </p>
        
        <p>
          Downline is a free and open-source video and audio downloader for
          YouTube, Vimeo, Dailymotion, SoundCloud and many other sites
        </p>
        <button @click="openLink('https://github.com/jarbun/downline/releases')">Visit Website</button>
      </div>
    </section>     
  </div>

  <script src="../static/js/vue.min.js"></script>
  <script src="./renderer.js"></script>
</body>
</html>